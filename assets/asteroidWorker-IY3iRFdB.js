(function(){let e,t,n,r,i,a,o,s=0;function c(e,t){let n=t<.8?e:Math.PI;for(let r=0;r<5;r++){let r=n-t*Math.sin(n)-e,i=1-t*Math.cos(n),a=r/i;if(n-=a,Math.abs(a)<1e-7)break}return n}self.onmessage=l=>{let u=l.data;if(u?.type===`init`)e=u.a,t=u.e,n=u.inc,r=u.Om,i=u.om,a=u.M0,o=u.P,s=u.count,self.postMessage({type:`ready`});else if(u?.type===`compute`){let l=u.time,d=u.scale||1,f=new Float32Array(s*3),p=Math.PI*2;for(let u=0;u<s;u++){let s=p/o[u],m=(a[u]+s*l+Math.PI)%p-Math.PI;m<-Math.PI&&(m+=p),m>Math.PI&&(m-=p);let h=t[u],g=c(m,h),_=Math.cos(g),v=Math.sin(g),y=(_-h)/(1-h*_),b=Math.sqrt(1-h*h)*v/(1-h*_),x=Math.atan2(b,y),S=e[u]*(1-h*h)/(1+h*Math.cos(x)),C=S*Math.cos(x),w=S*Math.sin(x),T=i[u],E=r[u],D=n[u],O=Math.cos(T),k=Math.sin(T),A=C*O-w*k,j=C*k+w*O,M=Math.cos(D),N=Math.sin(D),P=j*M,F=j*N,I=Math.cos(E),L=Math.sin(E),R=A*I-P*L,z=A*L+P*I,B=F,V=u*3;f[V]=R*d,f[V+1]=B*d,f[V+2]=-z*d}self.postMessage({type:`positions`,buffer:f.buffer},[f.buffer])}}})();